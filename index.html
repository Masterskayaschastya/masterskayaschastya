<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Мастерская счастья</title>
<link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&amp;display=swap" rel="stylesheet"/>
<style>
.hidden{display:none;}

    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background-color: #f7f5fa;
      color: #2e2e2e;
    }
    header {
      background-color: #e5d4f5;
      padding: 20px;
      text-align: center;
    }
    header h1 {
      font-family: 'UnifrakturCook', cursive;
      font-size: 3em;
      color: #6a1b9a;
      margin: 0;
    }
    nav {
      background-color: #d8b4e2;
      padding: 10px 0;
      text-align: center;
    }
    nav a {
      margin: 0 15px;
      text-decoration: none;
      color: #4a148c;
      font-weight: bold;
      font-size: 1.1em;
    }
    .banner {
  width: 100%;
  background-color: #d1b3e0;
  display: block;
  overflow: hidden;
}
    .about {
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      background-color: #ffffff;
      border-left: 10px solid #d8b4e2;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .about h2 {
      font-family: 'UnifrakturCook', cursive;
      color: #6a1b9a;
      font-size: 2em;
    }
    .about p {
      line-height: 1.6;
      font-size: 1.1em;
    }
    .catalog {
      max-width: 1000px;
      margin: 50px auto;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
    }
    .catalog-item {
      background-color: #fff;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #e1bee7;
      text-align: center;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
    }
    .catalog-item h3 {
      color: #7b1fa2;
      font-family: 'UnifrakturCook', cursive;
    }
    .catalog-item img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    footer {
      background-color: #e5d4f5;
      text-align: center;
      padding: 10px;
      margin-top: 50px;
      font-size: 0.9em;
    }
      .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 600px;
      border-radius: 10px;
      position: relative;
    }
    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover {
      color: #000;
    }
    .product-card {
      background-color: #f5f2f8;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      text-align: center;
    }
    .product-card img {
      width: 100%;
      max-width: 250px;
      height: auto;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    .product-card button {
      background-color: #ab47bc;
      color: #fff;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
    }
    .product-card button:hover {
      background-color: #8e24aa;
    }
    .cart-panel {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background-color: #fff;
      border: 2px solid #d8b4e2;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      width: 300px;
      z-index: 2000;
      max-height: 400px;
      overflow-y: auto;
      display: none;
    }
    .cart-panel h3 {
      margin-top: 0;
      color: #6a1b9a;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
      font-size: 0.95em;
    }
    .cart-total {
      font-weight: bold;
      margin-top: 10px;
      text-align: right;
    }
    .cart-panel button {
      margin-top: 10px;
      background-color: #ab47bc;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      width: 100%;
    }
    .cart-panel button:hover {
      background-color: #8e24aa;
    }

@media (max-width: 768px) {
  nav a {
    display: block;
    margin: 10px 0;
  }
  .catalog {
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    padding: 10px;
  }
  .modal-content {
    width: 95% !important;
    margin: 20% auto;
  }
  .product-card {
    flex: 1 1 100% !important;
    max-width: 100% !important;
  }
  .cart-panel {
    width: 90% !important;
    right: 5% !important;
    bottom: 10px !important;
  }
  input[type="text"], input[type="tel"] {
    font-size: 1em;
  }
  .banner img {
    width: 100%;
    height: auto;
  }
}
</style>
</head>
<body>
<header><div style="display:flex; align-items:center; justify-content:center; gap:15px; flex-wrap:wrap;"><img loading="lazy" alt="Логотип" src="assets/images/logo.jpg" style="height:60px; vertical-align:middle; margin-right:15px;"/><h1 style="margin: 0;">Мастерская счастья</h1></div></header>
<nav>
<a href="#">Главная</a>
<a href="#catalog">Каталог</a>
<a href="#about">О нас</a>
<a href="#contacts">Контакты</a>
<a href="#" id="cartLink" onclick="openModal('cartModal'); return false;">Корзина (0)</a></nav>
<section class="about" id="about">
<h2>О нас</h2>
<p>
      Добро пожаловать в маленькую мастерскую. Рада предложить калейдоскоп сумок, клатчей, интерьерных корзин,
      игрушек и сувениров ручной работы. Все мои работы выполнены с любовью, от души, с душой и для души.
      Практически все существуют в единственном экземпляре. Точный повтор исключён. Есть в наличии и под заказ.
      Но каждая работа уникальна, имеет свой характер, несёт позитивную энергетику. Теплые, уютные подарки для себя
      любимых, для близких и друзей упакованы в подарочную коробку. Каждый может найти здесь что-то интересное для себя.
      Впустите в свой дом Счастье.
    </p>
</section>
<section class="catalog" id="catalog">
<div class="catalog-item" onclick="openModal('bagsModal')">
<img loading="lazy" alt="Вязаные сумки" src="assets/images/bags.jpeg"/>
<h3>Вязаные сумки</h3>
</div>
<div class="catalog-item" onclick="openModal('basketsModal')">
<img loading="lazy" alt="Корзинки" src="assets/images/b.jpeg"/>
<h3>Корзинки</h3>
</div>
<div class="catalog-item" onclick="openModal('teaSetModal')">
<img loading="lazy" alt="Наборы для чаепития" src="assets/images/tea-sets.jpeg"/>
<h3>Наборы для чаепития</h3>
</div>
<div class="catalog-item" onclick="openModal('softToysModal')">
<img loading="lazy" alt="Мягкие игрушки" src="assets/images/toys11.jpeg"/>
<h3>Мягкие игрушки</h3>
</div>
<div class="catalog-item" onclick="openModal('boxesModal')"><img loading="lazy" alt="Шкатулки" src="assets/images/p.jpeg"/><h3>Шкатулки</h3></div><div class="catalog-item" onclick="openModal('souvenirsModal')"><img loading="lazy" alt="Сувениры" src="assets/images/gift.jpeg"/><h3>Сувениры</h3></div><div class="catalog-item" onclick="openModal('christmasModal')"><img loading="lazy" alt="Ёлочные игрушки" src="assets/images/chris1.jpeg"/><h3>Ёлочные игрушки</h3></div></section>
<!-- Модальные окна -->
<style>
  .product-list {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  .product-card {
    background-color: #f5f2f8;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    flex: 1 1 calc(33% - 40px);
    max-width: 200px;
    box-sizing: border-box;
  }
</style>
<!-- Пример модального окна с добавленными товарами -->
<!-- Модальное окно: Корзинки -->
<!-- Модальное окно: Подставки -->
</div>
</div>
</div>
</div><form action="https://formspree.io/f/xpwrrowl" class="modal" id="cartModal" method="POST" style="display: none;"><div class="modal-content"><span class="close" onclick="closeModal('cartModal')">×</span>
<h3>Корзина</h3>
<div id="cartItems"></div>
<div class="cart-total" id="cartTotal">Итого: 0 ₽</div>
<div class="promo-row" style="margin:10px 0; display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
  <input id="promoCodeInput" type="text" placeholder="Промокод" style="padding:8px 10px; border:1px solid #ccc; border-radius:5px; min-width:200px;">
  <button type="button" onclick="applyPromo()" style="padding:8px 12px; border-radius:6px; border:1px solid #b38cd9; background:#e9dbf7; cursor:pointer;">Применить</button>
  <span id="promoStatus" class="promo-status" style="min-height:1em;"></span>
</div>
<div class="cart-total" id="cartDiscount" style="display:none;">Скидка: -0 ₽</div>
<div class="cart-total" id="cartGrandTotal">К оплате: 0 ₽</div>

<input id="orderInput" name="order" type="hidden"/>
<input id="customerAddress" name="address" placeholder="Адрес доставки" required="" style="width: 100%; padding: 8px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px;" type="text"/>
<input id="customerName" name="name" placeholder="Ваше ФИО" required="" style="width: 100%; padding: 8px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px;" type="text"/>
<input id="customerPhone" name="phone" placeholder="Телефон" required="" style="width: 100%; padding: 8px; margin-top: 10px; border: 1px solid #ccc; border-radius: 5px;" type="tel"/>
<button type="submit">Оформить заказ</button>
<button onclick="manualDownload()" type="button">Скачать чек</button>
</div></form><script>
let cart = [];

function updateCartCounter() {
  const counter = cart.length;
  const link = document.getElementById('cartLink');
  if (link) link.textContent = `Корзина (${counter})`;
}

function addToCart(name, price) {
  console.log('Добавляем в корзину:', name, price);
  cart.push({ name, price });
  renderCart();
  updateCartCounter();
  document.getElementById('cartModal').style.display = 'block';
}

function removeFromCart(index) {
  cart.splice(index, 1);
  renderCart();
  updateCartCounter();
}


function renderCart() {
  const cartItems = document.getElementById('cartItems');
  const cartTotal = document.getElementById('cartTotal');
  const cartDiscount = document.getElementById('cartDiscount');
  const cartGrandTotal = document.getElementById('cartGrandTotal');

  if (cartItems) cartItems.innerHTML = '';
  let subtotal = 0;

  (Array.isArray(cart) ? cart : []).forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'cart-item';
    div.innerHTML = `<span>${item.name}</span><span>${item.price} ₽</span>
      <button onclick="removeFromCart(${index})" style='margin-left:10px;background:none;border:none;color:red;cursor:pointer;'>&times;</button>`;
    cartItems && cartItems.appendChild(div);
    subtotal += Number(item.price)||0;
  });

  const totals = getTotals();
  if (cartTotal) cartTotal.textContent = `Сумма: ${formatRub(subtotal)}`;
  if (cartDiscount) {
    if (totals.discount > 0) {
      cartDiscount.style.display = '';
      cartDiscount.textContent = `Скидка: -${formatRub(totals.discount)}`;
    } else {
      cartDiscount.style.display = 'none';
    }
  }
  if (cartGrandTotal) cartGrandTotal.textContent = `К оплате: ${formatRub(totals.total)}`;
}


function clearCart() {
  cart.length = 0;
  renderCart();
  updateCartCounter();
  document.getElementById('cartModal').style.display = 'none';
}


function prepareFormData(event) {
  event.preventDefault();

  const name = document.getElementById('customerName').value.trim();
  const phone = document.getElementById('customerPhone').value.trim();
  const address = document.getElementById('customerAddress').value.trim();

  if (!name || !phone || !address) {
    alert('Пожалуйста, заполните все поля.');
    return;
  }

  if (!Array.isArray(cart) || cart.length === 0) {
    alert('Корзина пуста!');
    return;
  }

  const totals = getTotals();
  const lines = cart.map(item => `${item.name} - ${item.price}₽`);
  lines.push('');
  lines.push(`Сумма: ${totals.subtotal}₽`);
  if (appliedPromo) {
    lines.push(`Промокод: ${appliedPromo} (-10%)`);
    lines.push(`Скидка: -${totals.discount}₽`);
  }
  lines.push(`К оплате: ${totals.total}₽`);
  lines.push('');
  lines.push(`ФИО: ${name}`);
  lines.push(`Телефон: ${phone}`);
  lines.push(`Адрес доставки: ${address}`);

  const orderDetails = lines.join('\n');
  document.getElementById('orderInput').value = orderDetails;

  alert('Ваш заказ отправлен! Спасибо!');
  document.getElementById('cartModal').submit();
  if (typeof downloadReceipt === 'function') {
    downloadReceipt(orderDetails);
  }

  cart.length = 0;
  appliedPromo = null;
  renderCart();
  updateCartCounter();
  document.getElementById('cartModal').style.display = 'none';
}


function downloadReceipt(orderText) {
  const blob = new Blob([orderText], { type: 'text/plain' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = 'чек_заказа.txt';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}


function openModal(id) {
  // Close all modals
  document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
  // Find the exact modal by id
  var el = document.getElementById(id);
  if (!el) {
    console.warn('Modal not found:', id);
    return;
  }
  el.style.display = 'block';
  document.body.style.overflow = 'hidden';
} else {
    el = document.getElementById(id);
  }
  if (el) {
    el.style.display = 'block';
    document.body.style.overflow = 'hidden';
  }
}

function closeModal(id) {
  var el = document.getElementById(id);
  if (el) el.style.display = 'none';
  // restore scroll if nothing else open
  var anyOpen = Array.from(document.querySelectorAll('.modal')).some(m => getComputedStyle(m).display === 'block');
  if (!anyOpen) document.body.style.overflow = '';
}

window.onclick = function(event) {
  const modals = document.querySelectorAll('.modal');
  modals.forEach(modal => {
    if (event.target === modal) {
      modal.style.display = 'none';
    }
  });
}
</script><script>
// --- Injected helpers ---

// Paginator for Boxes ("Шкатулки")
function showBoxPage(id) {
  const pages = document.querySelectorAll('#boxesModal .product-list[id^="boxesPage"]');
  pages.forEach(p => p.classList.add('hidden'));
  const target = document.getElementById(id);
  if (target) target.classList.remove('hidden');
}

// Attach submit handler to the cart form (so Enter works)
(function attachCartSubmit() {
  const modal = document.getElementById('cartModal');
  if (!modal) return;
  const form = modal.querySelector('form');
  if (form && !form.dataset.bound) {
    form.addEventListener('submit', function(e){
      if (typeof prepareFormData === 'function') {
        e.preventDefault();
        prepareFormData(e);
      }
    });
    form.dataset.bound = '1';
  }
})();

// Implement manualDownload() if a button calls it
if (typeof window.manualDownload !== 'function') {
  window.manualDownload = function() {
    try {
      const name = (document.getElementById('customerName')?.value || '').trim();
      const phone = (document.getElementById('customerPhone')?.value || '').trim();
      const address = (document.getElementById('customerAddress')?.value || '').trim();
      const cartList = (typeof window.cart !== 'undefined' && Array.isArray(window.cart)) ? window.cart : [];

      if (cartList.length === 0) {
        alert('Корзина пуста!');
        return;
      }

      const orderDetails = cartList.map(item => `${item.name} - ${item.price}₽`).join("\\n")
        + `\\n\\nФИО: ${name || '-'}\\nТелефон: ${phone || '-'}\\nАдрес доставки: ${address || '-'}`;

      if (typeof downloadReceipt === 'function') {
        downloadReceipt(orderDetails);
      } else {
        const blob = new Blob([orderDetails], {type: 'text/plain;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'order.txt';
        document.body.appendChild(a);
        a.click();
        URL.revokeObjectURL(url);
        a.remove();
      }
    } catch (err) {
      console.error('manualDownload error', err);
      alert('Не удалось сформировать чек.');
    }
  };
}

// Close any open modal on Escape
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
  }
});
</script>
<script>
if (!window.__modalClickBound) {
  window.__modalClickBound = true;
  document.addEventListener('click', function(e){
    const modal = e.target.closest('.modal');
    const content = e.target.closest('.modal-content');
    if (modal && !content) {
      modal.style.display = 'none';
      const anyOpen = Array.from(document.querySelectorAll('.modal')).some(m => getComputedStyle(m).display === 'block');
      if (!anyOpen) document.body.style.overflow = '';
    }
  });
}
</script>

<script>
// === Promo & totals ===
let PROMO_CODE = localStorage.getItem('PROMO_CODE') || 'HAPPINESS10'; // <-- можно поменять в любой момент
let appliedPromo = null;

function setPromoCode(code) {
  PROMO_CODE = String(code || '').trim();
  localStorage.setItem('PROMO_CODE', PROMO_CODE);
}

function getTotals() {
  const subtotal = (Array.isArray(cart) ? cart : []).reduce((s, it) => s + (Number(it.price)||0), 0);
  const discount = appliedPromo ? Math.round(subtotal * 0.10) : 0;
  const total = Math.max(0, subtotal - discount);
  return { subtotal, discount, total };
}

function formatRub(n) {
  n = Number(n)||0;
  return n.toLocaleString('ru-RU') + ' ₽';
}

function updatePromoStatus() {
  const el = document.getElementById('promoStatus');
  if (!el) return;
  if (appliedPromo) {
    el.textContent = 'Промокод применён: -10%';
    el.style.color = 'green';
  } else {
    el.textContent = '';
    el.style.color = '';
  }
}

function applyPromo() {
  const input = document.getElementById('promoCodeInput');
  const code = (input?.value || '').trim();
  if (!code) {
    appliedPromo = null;
  } else {
    appliedPromo = (PROMO_CODE && code.toUpperCase() === PROMO_CODE.toUpperCase()) ? code : null;
  }
  renderCart();
  updatePromoStatus();
}
</script>

<div class="modal" id="bagsModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('bagsModal')">&times;</span>
    <h2>Вязаные сумки</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<div class="modal" id="basketsModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('basketsModal')">&times;</span>
    <h2>Корзинки</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<div class="modal" id="teaSetModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('teaSetModal')">&times;</span>
    <h2>Наборы для чаепития</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<div class="modal" id="softToysModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('softToysModal')">&times;</span>
    <h2>Мягкие игрушки</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<div class="modal" id="boxesModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('boxesModal')">&times;</span>
    <h2>Шкатулки</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<div class="modal" id="souvenirsModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('souvenirsModal')">&times;</span>
    <h2>Сувениры</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<div class="modal" id="christmasModal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('christmasModal')">&times;</span>
    <h2>Ёлочные игрушки</h2>
    <div class="product-list">
      <p style="text-align:center;">Товары скоро будут добавлены...</p>
    </div>
  </div>
</div>
<script>
// Safer modal open delegation for catalog items
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.catalog-item[onclick]').forEach(function(el){
    const match = (el.getAttribute('onclick') || '').match(/openModal\('([^']+)'\)/);
    if (!match) return;
    const id = match[1];
    el.addEventListener('click', function(evt){
      evt.preventDefault();
      evt.stopPropagation();
      if (typeof openModal === 'function') {
        openModal(id);
      } else {
        const elModal = document.getElementById(id);
        if (elModal) elModal.style.display = 'block';
      }
    }, { capture: false });
  });
});
</script>
</body>
</html>
